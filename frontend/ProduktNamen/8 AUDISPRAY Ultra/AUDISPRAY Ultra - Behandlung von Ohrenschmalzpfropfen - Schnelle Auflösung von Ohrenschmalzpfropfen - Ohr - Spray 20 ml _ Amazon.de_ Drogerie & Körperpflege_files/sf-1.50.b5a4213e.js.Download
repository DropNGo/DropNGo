const e=()=>{window.dcmads=window.dcmads||{},window.dcmads.eids="4|40004007"},t="sfImpression",i="LightAdImpression",a="viewablelatency",n=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i});n("bodyBegin","bb"),n("bodyBegin","bb",t),n("bodyBegin","bb",i);const r=n("bodyEnd","be");n("clickToATF","af");const o=n("criticalFeature","cf");n("criticalFeature","cf",t),n("criticalFeature","cf",i);const s=n("loaded","ld"),l=n("loaded","ld",t);n("loaded","ld",i),n("viewablelatency:bodyBegin","bb",a),n("viewablelatency:loaded","ld",a);const d=()=>{Object.defineProperty(Document.prototype,"cookie",{get:()=>"",set:()=>{}})},c=()=>{var e,t;(null==(t=window)||null==(e=t.navigator)?void 0:e.geolocation)&&(window.navigator.geolocation.watchPosition=(e,t,i)=>0,window.navigator.geolocation.getCurrentPosition=(e,t,i)=>{})},m=(e,t)=>{console.error(e,t)},h=e=>{e.sendLatencyMetric(s),e.sendLatencyMetric(o)},u="sf iframe ready";var v,g,w=function(e){console.debug(e)},p=function(e,t){console.error(e,JSON.stringify(t)),y("ERROR",e,E(e,t))},f=function(e,t){console.error(e,JSON.stringify(t)),y("FATAL",e,E(e,t))},y=function(e,t,i){var a;null==(a=window.ueLogError)||a.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},E=function(e,t){return t instanceof Error?t:t?Error(t):Error(e)};const b=["amazon.com","amazon.in","amazon.de","amazon.co.jp","amazon.co.uk","amazon.ca","amazon.com.au","amazon.com.be","amazon.com.br","amazon.com.mx","amazon.com.tr","amazon.eg","amazon.es","amazon.fr","amazon.it","amazon.nl","amazon.pl","amazon.sa","amazon.se","amazon.sg","amazon.ae","amazon.co.za","amazon.cn","amazon.dev","boxofficemojo.com","a2z.com","console.harmony.a2z.com","depot.advertising.amazon.dev","harmony.a2z.com","d116tmsy8qpy37.cloudfront.net","d1u3onhraow3iz.cloudfront.net","d1ubtmbgqm1jlf.cloudfront.net","d2dk40qqpfbxei.cloudfront.net","d2jbcalcdp0p85.cloudfront.net","d2y0vsnh7zmbrq.cloudfront.net","d345aeerog89iv.cloudfront.net","imdb.com"],C=(e,t)=>t.some(t=>e.endsWith(t)),S=()=>{let e=document.referrer;if(!e)return!1;try{let t=new URL(e);return C(t.hostname,b)}catch(t){return p("Invalid referrer URL:",e),!1}};let T=null,I=null,M=null;const P=new class{viewabilityStandards(){return I=I||[]}payload(){return T=T||{}}},x={playingTime:()=>M=M||0},_=()=>P,A=()=>x,N=e=>{null===(T=(null==e?void 0:e.payload)!==void 0?null==e?void 0:e.payload:null)&&delete P.payload,null===(I=(null==e?void 0:e.viewabilityStandards)!==void 0?null==e?void 0:e.viewabilityStandards:null)&&delete P.viewabilityStandards},R=e=>{null===(M=e)&&delete x.playingTime},L="viewability",D="unservedviewability",F="adload:viewability",$="adload:unservedviewability",k="btr_client",z="cod_client",O=(e,t)=>{let i=()=>{var i,a;return null==e||null==(a=e.renderingWeblabs)||null==(i=a[t])?void 0:i.toLowerCase()};return{isT1:()=>"t1"===i(),isT2:()=>"t2"===i()}},V=()=>O(window,"ADPT_SF_HIGH_RATE_METRIC_LOGGING_1256364"),W=()=>O(window,"ADPT_SF_PIXEL_FIRING_1151992"),U=()=>O(window,"APM_STORES_JPS_JRS_SAFEFRAME_CLICK_TRACKING_PAINTER_TEST_1259727"),B=()=>O(window,"APM_STORES_JPS_JRS_SAFEFRAME_DEDUPE_SF_VIDEO_PIXELS_1279569"),J=()=>O(window,"APM_STORES_JPS_JRS_SAFEFRAME_ONERROR_COLLAPSE_1285300"),q=()=>O(window,"APM_STORES_JPS_JRS_SAFEFRAME_DOCUMENT_WRITE_1286180"),j=()=>O(window,"APM_STORES_JPS_JRS_SAFEFRAME_VIEW_RATE_EXPERIMENT_1289633"),G=()=>O(window,"ADPT_SF_EXTEND_REPLAY_TIMEOUT_1296395"),H=e=>"V"===e,K=e=>X(e),X=e=>decodeURIComponent(escape(atob(e))),Q=e=>e&&0===Object.keys(e).length&&e.constructor===Object,Y=e=>j().isT1()&&1004!==e,Z=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",ee=(e,t,i)=>{if(""===t)throw Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));let a=new URL(e),n=Object.assign(JSON.parse(a.searchParams.get(t)||"{}"),i);return a.searchParams.set(t,JSON.stringify(n)),a.toString()},et=(e,t)=>{let i=document.createElement("img");return i.id=e,i.style.display="none",i.setAttribute("pixel-url",t),i},ei=(e,t,i)=>{let a=e+t;return i&&(a+="_"+i),a},ea=e=>!!document.getElementById(e),en=async(e,{pixelUrl:t,id:i,baseCounterName:a,baseMetricName:n,counterExtension:r,logId:o,aaxProgramId:s})=>{try{if(ea(i))return!1;return e.logCsaEvent(ei(n,"fired",r)),e.countMetric(ei(a,"fired",r),1),await fetch(t,{keepalive:!0,mode:"no-cors",priority:"low"}),document.getElementsByTagName("body")[0].appendChild(et(i,t)),e.countMetric(ei(a,"loaded",r),1),e.logCsaEvent(ei(n,"loaded",r)),e.countMetric(`pixel:${o}`,1,!0),s&&e.countMetric(`pixel:${o}:${s}`,1,!0),!0}catch(i){throw e.countMetric(ei(a,"error",r),1),e.logCsaEvent(ei(n,"error",r)),e.logError(`Error firing pixels: ${t}`,i),i}},er=(e,t,i)=>e+t+JSON.stringify(i),eo="impressionFired",es="not_viewable";class el{constructor(){this._viewableStartTimeInMilliseconds=void 0,this._currentState=es,this._isCurrentlyInNotViewableState=()=>this._currentState===es,this.transitionToViewableState=e=>{this._isCurrentlyInNotViewableState()&&(this._viewableStartTimeInMilliseconds=e),this._currentState="viewable"},this.transitionToNotViewableState=()=>{this._currentState=es},this.getViewableTimeInSeconds=e=>this._isCurrentlyInNotViewableState()||void 0===this._viewableStartTimeInMilliseconds?0:(e-this._viewableStartTimeInMilliseconds)/1e3}}var ed=function(e){return ec(Array.from(e.querySelectorAll("img")).filter(function(e){return"none"!==getComputedStyle(e).display}))},ec=function(e){return 0===e.length?{success:!1,code:"NO_CREATIVE"}:e.some(function(e){return e.complete&&e.naturalWidth>0&&e.naturalHeight>0})?{success:!0,code:"BEGIN_TO_RENDER"}:{success:!1,code:"ERROR"}};class em{emitImpressionPixelMetrics(e){let t=this.o.adCreativeMetaData.adProgramId?this.o.adCreativeMetaData.adProgramId:"unknown",i=Z(this.o);this.c.countMetric(eo,1,!0),this.c.countMetric(eo+":program:"+t,1,!0),this.c.countMetric(eo+":template:"+i,1,!0);let a=e?"btr:impression":"cod:impression";this.c.countMetric(a,1,!1),this.c.countMetric(a,1,!0),this.c.countMetric(a+":program:"+t,1,!0),this.c.countMetric(a+":template:"+i,1,!0)}constructor(e,t){this.c=e,this.o=t,this.viewedPixels={},this.viewableTimeCalculators={},this.fireCodImpressionPixel=async()=>{let e=!1;await en(this.c,{id:"ape_impression",pixelUrl:eu(this.o.aaxImpPixelUrl,"pj",z),baseCounterName:"adload:impression",baseMetricName:"impression",logId:"imp:cod",aaxProgramId:this.o.adCreativeMetaData.adProgramId})&&this.emitImpressionPixelMetrics(!1)},this.fireViewablePixelsForVideo=(e,t,i,a,n)=>{if(Q(this.o)||Q(this.c)||!this.o.aaxInstrPixelUrl||!i)return;let r=(e,t,i)=>{let a=e>=i.t,n=t&&t>=i.t;return a&&n},o=e=>{let i;t.v=e;let n=window.aPageStart,r=window.adStartTime;t.ptv=n?(Date.now()-n)/1e3:0,t.ttv=r?(Date.now()-r)/1e3:0,a&&(t.niv=!0),a?(i=er(this.o.aaxInstrPixelUrl,"niv/",t),en(this.c,{id:"ape_ni_viewability_"+e.def,pixelUrl:i,baseCounterName:$,baseMetricName:D,counterExtension:e.def,logId:"view:niv",aaxProgramId:this.o.adCreativeMetaData.adProgramId})):(i=er(this.o.aaxInstrPixelUrl,"v/",t),en(this.c,{id:"ape_viewability_"+e.def,pixelUrl:i,baseCounterName:F,baseMetricName:L,counterExtension:e.def,logId:`view:${e.def}`,aaxProgramId:this.o.adCreativeMetaData.adProgramId}))},s=(e,t)=>{let i=e.def;t&&eh(t,e.p)?this.viewableTimeCalculators[i].transitionToViewableState(Date.now()):this.viewableTimeCalculators[i].transitionToNotViewableState();let a=this.viewableTimeCalculators[i].getViewableTimeInSeconds(Date.now());!this.viewedPixels[i].viewed&&r(a,n,e)&&(this.viewedPixels[i].viewed=!0,o(e))};for(let e=0;e<i.length;e++){let t=i[e].def;t&&(this.viewedPixels[t]=this.viewedPixels[t]||{},this.viewedPixels[t].viewed=void 0!==this.viewedPixels[t].viewed&&this.viewedPixels[t].viewed,void 0===this.viewableTimeCalculators[t]&&(this.viewableTimeCalculators[t]=new el))}for(let t=0;t<i.length;t++)s(i[t],e)},this.fireViewablePixels=(e,t,i,a)=>{let n=e=>{let i;t.v=e;let n=window.aPageStart,r=window.adStartTime;t.ptv=n?(Date.now()-n)/1e3:0,t.ttv=r?(Date.now()-r)/1e3:0,a&&(t.niv=!0),a?(i=er(this.o.aaxInstrPixelUrl,"niv/",t),en(this.c,{id:"ape_ni_viewability_"+e.def,pixelUrl:i,baseCounterName:$,baseMetricName:D,counterExtension:e.def,logId:"view:niv",aaxProgramId:this.o.adCreativeMetaData.adProgramId})):(i=er(this.o.aaxInstrPixelUrl,"v/",t),en(this.c,{id:"ape_viewability_"+e.def,pixelUrl:i,baseCounterName:F,baseMetricName:L,counterExtension:e.def,logId:`view:${e.def}`,aaxProgramId:this.o.adCreativeMetaData.adProgramId}))},r=t=>{let i=t.p,a=t.t,r=t.def;!this.viewedPixels[r].viewed&&e&&eh(e,i)?this.viewedPixels[r].timeout||(this.viewedPixels[r].timeout=setTimeout(()=>{this.viewedPixels[r].viewed=!0,n(t)},1e3*a)):this.viewedPixels[r].timeout&&(clearTimeout(this.viewedPixels[r].timeout),this.viewedPixels[r].timeout=null)};for(let e of i){var o;let t=e.def;(null==(o=this.viewedPixels)?void 0:o[t])||(this.viewedPixels[t]={viewed:!1,timeout:null}),r(e)}}}}const eh=(e,t)=>100*e>=t&&0!==t||100*e>t&&0===t,eu=(e,t,i)=>{let a=e.includes(".paets."),n=ee(e,t,{measurementMethod:i});return a?e:n},ev=async(e=document.body)=>{let t=0;return new Promise(i=>{let a=setInterval(()=>{t+=5,ed(e).success?(clearInterval(a),i(k)):t>=75&&(clearInterval(a),i(z))},5)})},eg=e=>{let t=`ProgramId: ${e.adCreativeMetaData.adProgramId}, CreativeId: ${e.adCreativeMetaData.adCreativeId}, AdId: ${e.adCreativeMetaData.adId}, Template: ${e.adCreativeMetaData.adCreativeTemplateName}`,i=ew(e.htmlContentEncodedLength);return`${t} (html size: ${i})`},ew=e=>void 0===e?"N/A":0===e?"0":e<=5e3?"0<x<=5k":e<=1e5?"5k<x<=100k":">100k",ep=e=>{var t;return null==(t=document.getElementById(ex))?void 0:t.setAttribute(e,"true")},ef=e=>new Promise((t,i)=>{let a=document.getElementById(ex);if((null==a?void 0:a.getAttribute(eP))==="true")t();else{if(document.addEventListener(e_,()=>{ep(eP),t()},{once:!0}),G().isT2())return void t();let n=G().isT1()?15e3:5e3;setTimeout(()=>{(null==a?void 0:a.getAttribute(eP))!=="true"&&i(Error(`Creative script replay not detected within ${n} timeout. ${eg(e)}`))},n)}}),ey=(e,t)=>{let i=setInterval(async()=>{var a,n;if("function"==typeof(null==(n=window)||null==(a=n.crv)?void 0:a.detectAndReportBlankAd)){clearInterval(i);try{await window.crv.detectAndReportBlankAd(document.body)?(t.countMetric("blankadvalidation:failure",1,!0),t.logBlankAd(`Blank ad detected. ${eg(e)}`)):t.countMetric("blankadvalidation:success",1,!0)}catch(e){t.countMetric("blankadvalidation:error",1,!0)}}},1e3)},eE=e=>e/window.innerWidth>=.95,eb=()=>{var e;return(null!=(e=document.documentElement.innerText)?e:"").replace(/\s/g,"").length>75},eC=e=>e.some(e=>e.classList.contains("ad-background-image")),eS=e=>{for(let t of e)if(eE(t.getBoundingClientRect().width))return!0;return!1},eT=()=>{let e=Array.from(document.querySelectorAll("img"));return!!e.length&&(!!eC(e)||!(!eS(e)||eb()))},eI=e=>{eT()&&e.sendMessage("resizeForImageOnlyTemplate")},eM=async(e,t,i,a)=>{let n=ef(a);if(null!==document.currentScript){let t=document.currentScript;for(t.insertAdjacentHTML("afterend",e),t=t.nextElementSibling;null!==t;)"SCRIPT"===t.tagName?eL(t):eF(t),t=t.nextElementSibling}else eD(e),eR(),eF(document.documentElement);t.ensureGlobals(),await n,await eO(),t.renderCompleteTime=new Date},eP="iscomplete",ex="creativeReplayStatus",e_="creativeReplayComplete",eA=`document.dispatchEvent(new CustomEvent("${e_}"));`,eN=()=>`<script id="${ex}">${eA}</script>`,eR=()=>{document.body.innerHTML+=eN()},eL=e=>{var t,i;let a=document.createRange();a.selectNode(e);let n=a.createContextualFragment(e.outerHTML).firstElementChild;if(n.getAttribute("src"))n.async=!1;else{let t=e.innerHTML;n.async=!1,n.setAttribute("src",`data:text/javascript;charset=UTF-8,${encodeURIComponent(t)}`)}null==(t=e.parentNode)||t.insertBefore(n,e.nextSibling),null==(i=e.parentNode)||i.removeChild(e)},eD=e=>{if(void 0==document.documentElement){let e=document.createElement("html");document.appendChild(e)}document.documentElement.innerHTML=e},eF=e=>{for(let t of e.querySelectorAll("script"))eL(t)},e$=e=>e.naturalWidth>0||e.naturalHeight>0,ek=e=>0===e.height||0===e.width,ez=e=>{!e.complete||e$(e)||ek(e)};async function eO(){let e=Array.from(document.querySelectorAll("img")).filter(ez).map(e=>new Promise(t=>{e.addEventListener("load",()=>{t()},{once:!0})}));await Promise.all(e)}const eV=(e,t,i,a,n)=>{a.onPreCreativeWrite(i),!Y(Number(i.adCreativeMetaData.adProgramId))&&(W().isT1()?e.sendMessage("sendEventAddedCreative"):n.hasFiredCODPixel||(i.firePixelsAfter?e.sendMessage("fireImpressionWithDelay"):t.fireCodImpressionPixel(),n.hasFiredCODPixel=!0))},eW=async(e,t,i,a,n)=>{eB(),eU();let r=e.btrPixelUrl?await ev():z;n.onCreativeBeginToRender(e);let o=r===k;o&&t.sendMessage("sendEventCreativeBeginToRender"),t.sendMessage("sendEventCreativeLoaded",{isBtr:o}),eq(),ey(e,a),eJ(e)&&eI(t)},eU=()=>{ep("creativeLoad"),tc()},eB=()=>{ep("creativedomcontentloaded"),document.dispatchEvent(new Event("DOMContentLoaded"))},eJ=e=>{var t;return["mweb","mshop"].includes(null==(t=e.deviceType)?void 0:t.toLowerCase())},eq=()=>{document.addEventListener("touchstart",{handleEvent:()=>{}},!1)},ej=new RegExp(/((&#\d{2,4};)|(&[a-z]{2};)|(&[a-z]{3,7};)|(%[a-fA-F0-9]{2})|(\W))pd_rd_plhdr(=|%3D)t((&#\d{2,4};)|(&[a-z]{2,7};)|(%[a-fA-F0-9]{2})|(\W))/),eG=(e,t)=>{let i=t,a=e;if("&pd_rd_plhdr=t"===e||""===e.trim())return i;(a=a.replace(/&amp;/g,"&")).startsWith("&")&&(a=a.replace(/^&+/,"")),a.endsWith("&")&&(a=a.replace(/&+$/,""));try{let e,t=0;do{if(t++,!(e=i.match(ej)))break;let n=e[1],r=e[8],o=e[7],s=n.startsWith("&")&&n.endsWith(";")||r.startsWith("&")&&r.endsWith(";"),l=n.startsWith("%")&&r.startsWith("%")&&"%3D"===o;i=s?i.replace(ej,"$1"+a.replace(/&/g,"&amp;")+"$8"):l?i.replace(ej,"$1"+encodeURIComponent(a)+"$8"):i.replace(ej,"$1"+a+"$8")}while(e&&t<10)}catch(e){return t}return i},eH=500,eK=async(e,t=eH)=>new Promise(i=>{let a=-1,n=e=>{let t=e.data,n="percolateClickTracking";if(t.command!==n)throw Error(`Unexpected command ${t}, Expected ${n}`);window.clearTimeout(a),i(t.data)};a=window.setTimeout(()=>{e.removeEventListener("message",n),i(""),w(`Did not receive percolateClickTracking within ${t}ms`)},t),e.addEventListener("message",n,{once:!0}),e.start()});class eX extends Error{}const eQ=(e,t)=>{let{onReport:i=()=>{}}=t;if(void 0!==window.ReportingObserver){let t=(t=[])=>{let a=eY(e);t.forEach(e=>{"intervention"===e.type&&i(new eX(JSON.stringify({adDetails:a,report:e.toJSON()})))})},a=new ReportingObserver(t,{buffered:!0});a.observe(),document.addEventListener("pagehide",()=>{t(a.takeRecords())})}},eY=e=>{let{adCreativeMetaData:t,creative:i,slotName:a,placementId:n,placementName:r,pageType:o}=e;return{adCreativeMetaData:t,creative:i,slotName:a,placementId:n,placementName:r,pageType:o}},eZ="APE_CW_METRICS";let e0=!1;const e1=e=>{e0||(window.addEventListener("beforeunload",()=>e9()),e0=!0);let t=e2();t.push(e),t.length>=10?e3(t):e5(t)},e2=()=>{let e=localStorage.getItem(eZ);if(!e)return[];try{return JSON.parse(e)}catch(e){return[]}},e3=e=>{navigator.sendBeacon("https://qdbx3pbnx6veby23pzgaowu3q40tmmrr.lambda-url.us-east-1.on.aws",JSON.stringify(e)),localStorage.removeItem(eZ)},e5=e=>{localStorage.setItem(eZ,JSON.stringify(e))},e9=()=>{let e=e2();e.length>0&&e3(e)},e8=({metricName:e,adDetails:t,count:i=1,additionalDimensions:a={}})=>{V().isT1()&&e1(e7(e,i,e4(t,a)))},e7=(e,t,i)=>({metricName:e,timestamp:new Date().getTime(),value:t,dimensions:i}),e4=(e,t)=>{var i,a;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:null==(i=e.adCreativeMetaData)?void 0:i.adProgramId,creativeTemplateName:null==(a=e.adCreativeMetaData)?void 0:a.adCreativeTemplateName,deviceType:e.deviceType,...t}},e6=e=>{if(!e.htmlContentEncoded||0===e.htmlContentEncoded.trim().length)throw Error("No html content found on a server side fetch");let t=e.htmlContentEncodedLength?e.htmlContentEncoded:K(e.htmlContentEncoded);return te(t,e.htmlContentEncodedLength),t},te=(e,t)=>{t&&e.length!==t&&console.debug(`Mismatched expected htmlContentEncoded size. Expected ${t} but got ${e.length}`)},tt={win:{t:0,b:0,l:0,r:0,w:0,h:0},self:{t:0,l:0,r:0,b:0,xiv:0,yiv:0,iv:0,z:0,w:0,h:0},exp:{t:0,l:0,r:0,b:0,xs:0,yx:0}},ti=((e=-1)=>{let t=e;return{set(e){t=e},get:()=>t}})(),ta=((e=tt)=>({set(t){e.self={...e.self,...t.self}},get:()=>e}))(),tn=()=>({ext:{inViewPercentage:()=>ti.get(),geom:()=>ta.get()}}),tr=async e=>{let t=to();ts(e,eN()),await t},to=()=>new Promise((e,t)=>{if(document.addEventListener(e_,()=>e(),{once:!0}),G().isT2())return void e();let i=G().isT1()?15:5;setTimeout(()=>t(Error(`${e_} timeout after ${i} seconds`)),1e3*i)}),ts=(...e)=>{let t=e.filter(e=>!!e).map(String).join("");if(null!==document.currentScript){let e=document.currentScript;for(e.insertAdjacentHTML("afterend",t),e=e.nextElementSibling;null!==e;)"SCRIPT"===e.tagName?eL(e):eF(e),e=e.nextElementSibling}else eD(t),eF(document.documentElement)};class tl{constructor(e,t,i,a,n,o){this.o=e,this.mp=t,this.cms=i,this.cmr=a,this.c=n,this.eventsChannel=o,this.renderCompleteTime=null,this.state={hasFiredCODPixel:!1},this.clickTrackingParam="",this.logInterventionReport=e=>{e8({metricName:"reporting-observer:heavy-ad-intervention",adDetails:this.o,additionalDimensions:{creativeId:this.o.adCreativeMetaData.adCreativeId}}),this.c.logFatal("heavy-ad-intervention",e)},this.initSFClient=async({timeout:e=eH}={})=>{this.ensureGlobals(),d(),c(),q().isT1()?document.write=ts:document.write=this.documentWriteDelegate,this.c.sendLatencyMetric(r),this.eventsChannel.onSafeFrameReady(this.o),U().isT1()||(this.clickTrackingParam=await eK(this.mp,e)),this.mp.onmessage=this.cmr.receiveMessage,this.c.countMetric("adload:iframeinitialized",1),this.c.logCsaEvent("adload_iframeinitialized"),await this.writeCreativeToDocument()},this.writeCreativeToDocument=async()=>{td(this,this.o);let e=G().isT1()?"T1":G().isT2()?"T2":"C";try{this.o.isNoInventory=!1;let t=eG(this.clickTrackingParam,e6(this.o));eV(this.cms,this.c.cr,this.o,this.eventsChannel,this.state),q().isT1()?(await tr(t),this.renderCompleteTime=new Date):await this.documentWriteDelegate(t),this.c.logAPIInvocation(`creativeReplayComplete_${e}`),this.eventsChannel.onPostCreativeWrite(this.o),await eW(this.o,this.cms,this.c.cr,this.c,this.eventsChannel),this.eventsChannel.onCreativeLoad(this.o),U().isT1()&&document.body.addEventListener("click",()=>{this.eventsChannel.onClick(this.o)},{once:!0})}catch(t){this.c.logError("Failed to get creative content",t),this.c.collapseSlotInternal("CLIENTSETUP"),this.c.logAPIInvocation(`collapseSlotCLIENTSETUP_${e}`),this.eventsChannel.onError(this.o)}},this.ensureGlobals=()=>{var e;window.onerror=this.handleErrors,window.$sf=null!=(e=window.$sf)?e:tn(),window.$sfViewableInfo=_(),window.aaxInstrPixelUrl=this.o.aaxInstrPixelUrl},this.documentWriteDelegate=async e=>await eM(e,this,this.c,this.o),this.handleErrors=(e,t,i,a,n)=>{let r=n||Error(e.toString());return this.c.logError(`Window.onerror triggered inside of the iframe. Src: ${t}:${i}:${a}`,r),J().isT1()?ed(document.body).success||this.c.collapseSlotInternal("CLIENTERROR"):this.renderCompleteTime||this.c.collapseSlotInternal("CLIENTERROR"),this.eventsChannel.onError(this.o),!0};let s=document.open.bind(document);document.open=(...e)=>{let t=s(...e);return this.ensureGlobals(),t},this.nativeWrite=document.write.bind(document),window.onerror=this.handleErrors,eQ(this.o,{onReport:this.logInterventionReport})}}const td=(e,t)=>{t.creativeSupportsTTIMeasurement||window.addEventListener("load",()=>h(e.c),{once:!0}),window.addEventListener("load",()=>e.c.fireViewableLatencyMetrics(),{once:!0})},tc=()=>{window.dispatchEvent(new Event("load"))};class tm{constructor(e,t,i){this.cms=e,this.o=t,this.mL=i,this.fireImpression=async e=>{this.sendLatencyMetric(l),await this.cr.fireCodImpressionPixel()},this.changeSize=(e,t)=>{this.cms.sendMessage("changeSize",{width:e,height:t})},this.logCsaEvent=e=>{this.cms.sendMessage("logCsaEvent",{metricName:e})},this.registerCustomMessageListener=(e,t)=>{this.mL[e]=t,this.countMetric("sf:commonmain:registerCustomMessageListener",1,!0)},this.sendLatencyMetric=e=>{this.cms.sendMessage("sendLatencyMetric",{latencyMetricType:e,timestamp:new Date})},this.countMetric=(e,t=1,i=!1)=>{this.cms.sendMessage("countMetric",{metricMsg:e,value:t,isGlobal:i})},this.fireViewableLatencyMetrics=()=>{this.cms.sendMessage("fireViewableLatencyMetrics",{adLoadedTimestamp:Date.now()})},this.feedbackLabelRendered=()=>{this.cms.sendMessage("feedbackLabelRendered")},this.feedbackOpenModal=()=>{this.cms.sendMessage("feedbackOpenModal")},this.updateViewability=e=>{var t,i,a,n,r,o,s;let l=_();if(N(e),!this.o.aaxInstrPixelUrl||!l.payload||!l.viewabilityStandards)return;let d=(null==(a=window)||null==(i=a.$sf)||null==(t=i.ext)?void 0:t.geom)&&(null==(r=window)||null==(n=r.$sf)?void 0:n.ext.geom()),c=(null==d||null==(o=d.self)?void 0:o.iv)?null==d||null==(s=d.self)?void 0:s.iv:null;if(H(this.o.mediaType)){let e=A();this.cr.fireViewablePixelsForVideo(c,l.payload(),l.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}},this.updatePlayingTimeForVideo=e=>{if(B().isT1())this.cms.sendMessage("sendSfVideoContinuousPlaytimeSeconds",{sfVideoContinuousPlaytimeSeconds:e});else{var t,i,a,n;let r=_();R(e);let o=(null==(a=window)||null==(i=a.$sf)||null==(t=i.ext)?void 0:t.geom)&&window.$sf.ext.geom(),s=null==o||null==(n=o.self)?void 0:n.iv;if(s&&r.payload&&r.viewabilityStandards){let e=A();this.cr.fireViewablePixelsForVideo(s,r.payload(),r.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}}},this.requestVideoAutoplay=()=>{this.cms.sendMessage("requestVideoAutoplay")},this.releaseVideoAutoplay=()=>{this.cms.sendMessage("releaseVideoAutoplay")},this.haveVideoAutoplayPermission=()=>{this.cms.sendMessage("haveVideoAutoplayPermission")},this.isOnAmazon=()=>!0,this.logError=(e,t,i)=>{this.cms.sendMessage("logError",{message:e,error:t,level:i})},this.logFatal=(e,t,i)=>{this.cms.sendMessage("logFatal",{message:e,error:t,level:i})},this.logBlankAd=(e,t,i)=>{this.cms.sendMessage("logBlankAd",{message:e,error:t,level:i})},this.collapseSlotInternal=e=>{this.logAPIInvocation("collapseSlot"),this.logAPIInvocation(`collapseSlot${e}`),this.cms.sendMessage("collapseSlot",e)},this.collapseSlot=()=>{this.collapseSlotInternal("CREATIVE")},this.resizeCreativeWrapper=e=>{let t=window.document.getElementById(`ape_${this.o.scope}_creativeWrapper`);null!==t&&(t.style.height=e.height,t.style.width=e.width)},this.triggerEventInIframe=e=>{window.dispatchEvent(new Event("outerpage"+e.eventType))},this.logAPIInvocation=(e,...t)=>{this.cms.sendMessage("logAPIInvocation",{apiName:e,apiParams:t}),this.cms.sendMessage("logCsaEvent",{metricName:"messenger_"+e})},this.setupComputedAdDetails=e=>{window.aPageStart=e.aPageStart,window.adStartTime=e.adStartTime},this.signalAdLoadedAndInteractive=()=>{h(this)},this.sendEventAddedCreative=()=>{this.cms.sendMessage("sendEventAddedCreative")},this.populateGeom=e=>ta.set(e.geom),this.populateSafeFrameExt=e=>{ti.set(e.inViewPercentage),ta.set(e.geom)},this.cr=new em(this,t)}}class th{constructor(e,t){this.o=e,this.messagePort=t,this.sendMessage=(e,t)=>{let i={command:e,adDetails:this.o,payload:t||{}};try{this.messagePort.postMessage(i)}catch(e){m("Post Message error",e)}}}}class tu{constructor(e,t,i){this.c=e,this.o=t,this.mL=i,this.pendingMessages=new Map,this.waitForMessageProcessed=async e=>new Promise(t=>this.pendingMessages.set(e,t)),this.receiveMessage=e=>{try{let t=e.data,i=t.command?t.command.split("."):[],a=this.c[i[0]];for(let e=1;e<i.length;e++)if(a)a=a[i[e]];else break;if("customMessage"===t.command){let e=t.data.key,i=t.data.data;if("function"==typeof this.mL[e])try{this.mL[e](i)}catch(e){this.c.logError("Custom Message Listener Error",e)}}else a&&(a(t.data),tv(t.command,this.pendingMessages))}catch(t){this.c.logError("Error with "+e.data.command,t);return}}}}const tv=(e,t)=>{let i=null==t?void 0:t.get(e);null==i||i(),null==t||t.delete(e)};class tg extends tm{constructor(e,t,i){super(e,t,i),this.isSupported=()=>!0,this.getARID=()=>this.o.arid,this.sendAdInfo=e=>{e&&this.o.adCreativeMetaData&&(this.o.adCreativeMetaData=e)},this.getPlacementInfo=()=>(this.logAPIInvocation("getPlacementInfo"),{slot:this.o.placementName,slotName:this.o.slotName,pageType:this.o.pageType})}}const tw=e=>({onSafeFrameReady:t=>tp(e,"onSafeFrameReady",t),onPreCreativeWrite:t=>tp(e,"onPreCreativeWrite",t),onPostCreativeWrite:t=>tp(e,"onPostCreativeWrite",t),onCreativeBeginToRender:t=>tp(e,"onCreativeBeginToRender",t),onCreativeLoad:t=>tp(e,"onCreativeLoad",t),onError:t=>tp(e,"onError",t),onClick:t=>tp(e,"onClick",t)}),tp=(e,t,i)=>{try{e.postMessage({command:t,adDetails:i,payload:{}})}catch(e){m("Post Message error",e)}},tf=(e,t)=>{let i=new th(e,t),a={},n=new tg(i,e,a),r=new tu(n,e,a),o=tw(t);return new tl(e,t,i,r,n,o)},ty=async(t,i,a)=>{try{var n,r,o;e(),window.renderingWeblabs=JSON.parse(null!=(o=a.weblabTreatments)?o:""),null==(r=performance)||null==(n=r.mark)||n.call(r,"SafeFrame: SF received ad details");let s=t(i,a);try{s.initSFClient()}catch(e){s.c.logError("Could not init SafeFrame Client",e)}}catch(e){m("Could not init ",e)}},tE=e=>{var t,i;null==(i=performance)||null==(t=i.mark)||t.call(i,`SafeFrame: Start Send Ready ${e}`);try{window.parent.dispatchEvent(new MessageEvent("message",{source:window,origin:window.location.origin,ports:[e],data:u}))}catch(t){window.parent.postMessage(u,"*",[e])}},tb=()=>""!==window.name?JSON.parse(window.name):null;null==(g=performance)||null==(v=g.mark)||v.call(g,"SafeFrame: Enter sf.ts"),window.SFClient||(e=>{if("null"!==window.origin&&!S())return f(`Referrer not allowed: ${document.referrer}`);let t=tb();if(t){let i=new MessageChannel;ty(e,i.port1,t),tE(i.port2)}else p("Ad Details not found in name!")})((e,t)=>{let i=tf(t,e);return window.SFClient=i.c,i});
//# sourceMappingURL=sf-1.50.b5a4213e.js.map
